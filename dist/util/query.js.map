{"version":3,"sources":["../../src/util/query.js"],"names":["getEve","eveHost","Widget","parseEveName","eve","split","eName","map","blur","focus","parseQuery","_rule","regPropVal","regPropBool","regTagName","aRule","props","dataset","matchPropVal","exec","rule","matchPropBool","matchTagName","val","replace","indexOf","slice","tagName","toUpperCase","$","query","scope","window","jQuery","zepto","$nodeList","document","querySelectorAll","Array","isArray","HTMLElement","NodeList","HTMLCollection","each","func","forEach","node","i","call","get","find","nodeList","push","eq","html","cont","innerHTML","prop","name","css","style","filter","aQuery","$newNodeList","some","Object","keys","every","key","removeClass","cn","setClassList","Set","classList","delete","className","from","join","addClass","add","on","tar","e","isHitted","contains","target","trigger","env","addEventListener","off","removeEventListener"],"mappings":"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","file":"query.js","sourcesContent":["import Widget from './Widget';\n\nconst getEve = eveHost => {\n  if (eveHost) return eveHost;\n  return new Widget();\n};\n\nconst parseEveName = eve=>{\n  let [eName] = eve.split('.');\n  const map = {\n    blur: 'focusout',\n    focus:'focusin',\n  }\n  return map[eName] || eName;\n}\n\nconst parseQuery = function(_rule) {\n  if (typeof _rule !== 'string') _rule = '';\n\n  const regPropVal = /\\[([^=]+)=(\\S+)\\]/;\n  const regPropBool = /\\:(\\S+)/;\n  const regTagName = /^([a-zA-Z0-9]+)/;\n\n  const aRule = _rule.split(',');\n\n  return aRule.map(rule => {\n    const props = {};\n    const dataset = {};\n\n    const matchPropVal = regPropVal.exec(rule);\n    const matchPropBool = regPropBool.exec(rule);\n    const matchTagName = regTagName.exec(rule);\n\n    if (matchPropVal) {\n      const val = matchPropVal[2].replace(/\"|'/g, '');\n\n      if (matchPropVal[1].indexOf('data-') === 0) {\n        dataset[matchPropVal[1].slice(5)] = val;\n      } else {\n        props[matchPropVal[1]] = val;\n      }\n    }\n    if (matchPropBool) {\n      props[matchPropBool[1]] = true;\n    }\n    if (matchTagName) {\n      props.tagName = matchTagName[1].toUpperCase();\n    }\n\n    return { props, dataset };\n  });\n};\n\n/**\n * jquery lite, only for FormController uses.\n * @param {string} query\n * @param {object} scope\n */\nconst $ = function(query, scope) {\n  if ('jQuery' in window || 'zepto' in window) {\n    return (window.jQuery || window.zepto)(query, scope);\n  }\n\n  let $nodeList;\n  if (query && typeof query === 'string') {\n    if (!scope) scope = document;\n    $nodeList = [...scope.querySelectorAll(query)];\n  } else if (Array.isArray(query)) {\n    $nodeList = query;\n  } else if (query instanceof HTMLElement) {\n    $nodeList = [query];\n  } else if (query instanceof NodeList || query instanceof HTMLCollection) {\n    $nodeList = [...query];\n  } else {\n    $nodeList = [];\n  }\n\n  let eveHost; // event host\n\n  return {\n    each(func) {\n      $nodeList.forEach((node, i) => func.call(node, i, node));\n      return this;\n    },\n    map(func) {\n      if (!func) return this;\n      return $($nodeList.map((node, i) => func.call(node, i, node)));\n    },\n    get() {\n      return $nodeList;\n    },\n    find(rule) {\n      const nodeList = [];\n      this.each(function() {\n        $(rule, this).each(function() {\n          nodeList.push(this);\n        });\n      });\n      return $(nodeList);\n    },\n    eq(i) {\n      return $nodeList[i];\n    },\n    html(cont) {\n      if (typeof cont === 'undefined') {\n        return $nodeList[0] && $nodeList[0].innerHTML;\n      } else {\n        this.each(function() {\n          this.innerHTML = cont;\n        });\n        return this;\n      }\n    },\n    prop(name, val) {\n      this.each(function() {\n        this[name] = val;\n      });\n      return this;\n    },\n    css(name, val) {\n      this.each(function() {\n        this.style[name] = val;\n      });\n      return this;\n    },\n    /**\n     *\n     * @param {string} rule only support tagName[propName1=\"val\"]:propName2,\n     *                      no className or children selector like '>| '.\n     */\n    filter(rule) {\n      const aQuery = parseQuery(rule);\n\n      const $newNodeList = $nodeList.filter(node => {\n        return aQuery.some(({ props, dataset }) => {\n          return (\n            Object.keys(props).every(key => node[key] === props[key]) &&\n            Object.keys(dataset).every(\n              key => node.dataset[key] === dataset[key]\n            )\n          );\n        });\n      });\n\n      return $($newNodeList);\n    },\n    removeClass(cn) {\n      this.each(function() {\n        const setClassList = new Set(this.classList);\n        setClassList.delete(cn);\n        this.className = Array.from(setClassList).join(' ');\n      });\n      return this;\n    },\n    addClass(cn) {\n      this.each(function() {\n        this.className = Array.from(new Set(this.classList).add(cn)).join(' ');\n      });\n      return this;\n    },\n    on(eve, tar, func) {\n      eveHost = getEve(eveHost);\n      if (typeof func !== 'function') {\n        func = tar;\n        tar = false;\n      }\n\n      eveHost.on(eve, func);\n\n      // 为了方便注销事件，同一个事件只需要绑定一次\n      if (!eveHost[eve]) {\n        eveHost[eve] = function(e) {\n          if (tar) {\n            this['_proxyEventTarget_' + tar].get().some(node => {\n              const isHitted = node.contains(e.target);\n\n              isHitted &&\n                eveHost.trigger(\n                  {\n                    eve,\n                    env: node\n                  },\n                  e\n                );\n              return isHitted;\n            });\n          } else {\n            eveHost.trigger(eve, e);\n          }\n        };\n        this.each(function() {\n          if (tar) {\n            this['_proxyEventTarget_' + tar] = $(tar, this);\n          }\n          this.addEventListener(parseEveName(eve), eveHost[eve], false);\n        });\n      }\n\n      return this;\n    },\n    off(eve, func) {\n      eveHost = getEve(eveHost);\n\n      eveHost[eve] &&\n        this.each(function() {\n          this.removeEventListener(parseEveName(eve), eveHost[eve], false);\n        });\n\n      eveHost.off(eve);\n      delete eveHost[eve];\n      return this;\n    }\n  };\n};\n\nexport default $;\n"]}